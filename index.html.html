<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ­Ù‚ÙŠÙ‚ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            transition: 0.3s;
        }
        
        body.dark {
            background: linear-gradient(135deg, #0a0e27, #1a1a3e);
            color: white;
        }
        
        body.light {
            background: linear-gradient(135deg, #f5f5f5, #ffffff);
            color: black;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 107, 53, 0.15);
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(to right, #ff6b35, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .theme-btn {
            padding: 10px 20px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .screen { display: none; }
        .screen.active { display: block; }
        
        /* Login */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }
        
        .login-box {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 40px;
            border-radius: 15px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-box h2 {
            color: #ff6b35;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .login-box input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ff6b35;
            border-radius: 5px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
        }
        
        .login-box button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(to right, #ff6b35, #f7931e);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }
        
        /* Teams */
        .teams-title {
            text-align: center;
            font-size: 2em;
            color: #ff6b35;
            margin-bottom: 30px;
        }
        
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .team-card {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }
        
        .team-card.selected {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .team-card h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }
        
        .team-members {
            font-size: 0.9em;
            margin: 10px 0;
        }
        
        .team-members p {
            margin: 5px 0;
        }
        
        .leader-badge {
            color: #ffd700;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .team-actions {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .team-actions input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ff6b35;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            font-size: 0.85em;
        }
        
        .team-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
        }
        
        .team-btn:hover {
            background: #f7931e;
        }
        
        .team-btn.danger {
            background: #ff4444;
        }
        
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #ffd700, #ff6b35);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            display: none;
        }
        
        .start-btn.show {
            display: block;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .modal-content h3 {
            color: #ff6b35;
            margin-bottom: 20px;
        }
        
        .modal-content p {
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        
        .modal-confirm {
            background: #4CAF50;
            color: white;
        }
        
        .modal-cancel {
            background: #888;
            color: white;
        }
        
        /* Leader Selection */
        .leader-selection {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .leader-selection h4 {
            color: #ff6b35;
            margin-bottom: 15px;
        }
        
        .leader-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .leader-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #ff6b35;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .leader-option:hover {
            background: rgba(255, 107, 53, 0.2);
        }
        
        .leader-option.selected {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
        }
        
        .leader-option input[type="radio"] {
            margin-left: 10px;
        }
        
        /* Challenge */
        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 107, 53, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .timer {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .timer.danger {
            color: #ff0000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .team-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .team-name {
            font-size: 1.2em;
            color: #ffd700;
            font-weight: bold;
        }
        
        .team-leader {
            font-size: 0.9em;
            color: #ff6b35;
        }
        
        .case-box {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 30px;
            border-radius: 15px;
        }
        
        .case-title {
            font-size: 1.8em;
            color: #ff6b35;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .images-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .image-box {
            width: 100%;
            height: 120px;
            background: rgba(255, 107, 53, 0.2);
            border: 2px solid #ff6b35;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-box:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }
        
        .image-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .pdf-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .pdf-btn:hover {
            background: #45a049;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .code-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff6b35;
            border-radius: 5px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            text-align: center;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .code-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(to right, #ff6b35, #f7931e);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }
        
        .message {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            min-height: 25px;
            font-size: 1.1em;
        }
        
        .message.success {
            color: #4CAF50;
        }
        
        .message.error {
            color: #ff0000;
            animation: shake 0.3s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .progress {
            text-align: center;
            margin-top: 20px;
            color: #ff6b35;
            font-size: 1.1em;
        }
        
        .star {
            position: fixed;
            pointer-events: none;
            font-size: 2em;
            animation: starburst 1.5s ease-out forwards;
            z-index: 9999;
        }
        
        @keyframes starburst {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); }
        }
        
        /* Leaderboard */
        .leaderboard-title {
            font-size: 2.5em;
            text-align: center;
            color: #ff6b35;
            margin-bottom: 30px;
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 107, 53, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .leaderboard-table th,
        .leaderboard-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ff6b35;
        }
        
        .leaderboard-table th {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
            font-weight: bold;
        }
        
        .restart-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #ffd700, #ff6b35);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
        }
        
        /* Fail */
        .fail-box {
            text-align: center;
            padding: 60px 20px;
        }
        
        .fail-title {
            font-size: 3em;
            color: #ff0000;
            margin-bottom: 30px;
            animation: pulse 1s infinite;
        }
        
        .fail-details {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        @media (max-width: 768px) {
            .images-grid { grid-template-columns: repeat(2, 1fr); }
            .teams-grid { grid-template-columns: 1fr; }
            .challenge-header { flex-direction: column; gap: 10px; }
            .team-info { align-items: center; }
        }
    </style>
</head>
<body class="dark">
    <div class="container">
        <div class="header">
            <h1>ğŸ” Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ­Ù‚ÙŠÙ‚</h1>
            <button class="theme-btn" onclick="toggleTheme()">ğŸŒ“</button>
        </div>
        
        <!-- Login -->
        <div class="screen active" id="loginScreen">
            <div class="login-screen">
                <div class="login-box">
                    <h2>ğŸ® Ù…Ø±Ø­Ø¨Ø§Ù‹</h2>
                    <input type="text" id="userName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" onkeypress="if(event.key==='Enter') goToTeams()">
                    <button onclick="goToTeams()">Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
        </div>
        
        <!-- Teams -->
        <div class="screen" id="teamsScreen">
            <h2 class="teams-title">ğŸ‘¥ Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</h2>
            <div class="teams-grid" id="teamsContainer"></div>
            <button class="start-btn" id="startBtn" onclick="startChallenge()">â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
        </div>
        
        <!-- Challenge -->
        <div class="screen" id="challengeScreen">
            <div class="challenge-header">
                <div class="timer" id="timerDisplay">02:00:00</div>
                <div class="team-info">
                    <div class="team-name" id="currentTeamName"></div>
                    <div class="team-leader" id="leaderInfo"></div>
                </div>
            </div>
            <div class="case-box" id="caseBox"></div>
        </div>
        
        <!-- Leaderboard -->
        <div class="screen" id="leaderboardScreen">
            <h2 class="leaderboard-title">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>ğŸ¥‡</th>
                        <th>Ø§Ù„ÙØ±ÙŠÙ‚</th>
                        <th>Ø§Ù„Ù‚Ø§Ø¦Ø¯</th>
                        <th>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th>
                        <th>Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</th>
                        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
            </table>
            <button class="restart-btn" onclick="location.reload()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        
        <!-- Fail -->
        <div class="screen" id="failScreen">
            <div class="fail-box">
                <div class="fail-title">â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</div>
                <div class="fail-details" id="failDetails"></div>
                <button class="restart-btn" onclick="location.reload()">ğŸ”„ Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalTitle">ØªØ£ÙƒÙŠØ¯</h3>
            <p id="modalMessage"></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-confirm" onclick="confirmAction()">Ù†Ø¹Ù…ØŒ Ù…ØªØ£ÙƒØ¯</button>
                <button class="modal-btn modal-cancel" onclick="cancelAction()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    
    <!-- Leader Selection Modal -->
    <div class="modal" id="leaderModal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>Ø§Ø®ØªØ± Ù‚Ø§Ø¦Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚</h3>
            <p>Ù…Ù† Ø³ÙŠÙƒÙˆÙ† Ù‚Ø§Ø¦Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚ <strong id="teamNameForLeader"></strong>ØŸ</p>
            <div class="leader-options" id="leaderOptions"></div>
            <div class="modal-buttons" style="margin-top: 20px;">
                <button class="modal-btn modal-confirm" onclick="confirmLeader()">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>
    
    <script>
        let user = null, team = null, selectedLeader = null, caseIdx = 0, timer = null, timeLeft = 7200;
        let stats = {}, allStats = {};
        let pendingAction = null, pendingTeamId = null;
        
        const teams = Array(10).fill(0).map((_, i) => ({
            id: i + 1, 
            name: `Ø§Ù„ÙØ±ÙŠÙ‚ ${i + 1}`, 
            members: [], 
            leader: null, 
            teamName: null
        }));
        
        const cases = [
            {id: 1, title: 'Ù…Ù† ÙŠÙƒÙˆÙ†ØŸ', code: 'SCREAM001'},
            {id: 2, title: 'Ù…Ù„Ù Ø§Ù„Ø°ÙƒØ§Ø¡', code: 'GHOSTFACE'},
            {id: 3, title: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', code: 'PROFILE99'},
            {id: 4, title: 'Ø§Ù„Ø£Ø¯Ù„Ø©', code: 'EVIDENCE1'},
            {id: 5, title: 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', code: 'CHEMICAL2'},
            {id: 6, title: 'Ø£Ø¯Ù„Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', code: 'EVIDENCE3'},
            {id: 7, title: 'Ø®Ø· Ø§Ù„Ø¯Ù…', code: 'BLOODLINE'},
            {id: 8, title: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ', code: 'FORENSICS'},
            {id: 9, title: 'Ø§Ù„Ø¶Ø­ÙŠØ©', code: 'VICTIM666'},
            {id: 10, title: 'Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡', code: 'SUSPECT42'}
        ];
        
        function toggleTheme() {
            document.body.classList.toggle('dark');
            document.body.classList.toggle('light');
        }
        
        function goToTeams() {
            user = document.getElementById('userName').value.trim();
            if (!user) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ');
            showScreen('teamsScreen');
            renderTeams();
        }
        
        function renderTeams() {
            let html = '';
            teams.forEach(t => {
                const isMember = t.members.includes(user);
                const isLeader = t.leader === user;
                
                html += `<div class="team-card ${team && team.id === t.id ? 'selected' : ''}">
                    <h3>${t.teamName || t.name}</h3>
                    <div class="team-members">
                        <p>ğŸ‘¥ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${t.members.length}/4</p>
                        ${t.members.length > 0 ? `<p style="font-size:0.8em">${t.members.join(', ')}</p>` : ''}
                        ${t.leader ? `<p class="leader-badge">â­ Ø§Ù„Ù‚Ø§Ø¦Ø¯: ${t.leader}</p>` : '<p style="color:#999">Ø¨Ù„Ø§ Ù‚Ø§Ø¦Ø¯</p>'}
                    </div>
                    
                    <div class="team-actions">
                        ${isLeader ? `
                            <input type="text" id="teamName${t.id}" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚" value="${t.teamName || ''}" onchange="updateTeamName(${t.id})">
                            <button class="team-btn" onclick="editTeam(${t.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</button>
                        ` : ''}
                        
                        ${!isMember && t.members.length < 4 ? `<button class="team-btn" onclick="showLeaderSelection(${t.id})">âœ… Ø§Ù†Ø¶Ù…</button>` : ''}
                        
                        ${isMember ? `<button class="team-btn danger" onclick="confirmLeaveTeam(${t.id})">âŒ ØºØ§Ø¯Ø±</button>` : ''}
                    </div>
                </div>`;
            });
            document.getElementById('teamsContainer').innerHTML = html;
        }
        
        function showLeaderSelection(teamId) {
            const t = teams.find(tm => tm.id === teamId);
            if (t.members.length === 0) {
                // First member becomes leader automatically
                t.members.push(user);
                t.leader = user;
                team = t;
                selectedLeader = user;
                document.getElementById('startBtn').classList.add('show');
                renderTeams();
            } else {
                // Show modal to select leader
                pendingTeamId = teamId;
                document.getElementById('teamNameForLeader').textContent = t.teamName || t.name;
                
                let options = '<div class="leader-options">';
                t.members.forEach(member => {
                    options += `<label class="leader-option">
                        <input type="radio" name="leader" value="${member}" onchange="selectLeaderOption('${member}')">
                        ${member} ${t.leader === member ? '(Ø§Ù„Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ)' : ''}
                    </label>`;
                });
                options += `<label class="leader-option" style="border: 2px dashed #ff6b35;">
                    <input type="radio" name="leader" value="${user}" onchange="selectLeaderOption('${user}')">
                    Ø£Ù†Ø§ (${user})
                </label></div>`;
                
                document.getElementById('leaderOptions').innerHTML = options;
                document.getElementById('leaderModal').classList.add('show');
            }
        }
        
        function selectLeaderOption(leader) {
            selectedLeader = leader;
            document.querySelectorAll('.leader-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.parentElement.classList.add('selected');
        }
        
        function confirmLeader() {
            if (!selectedLeader) return alert('Ø§Ø®ØªØ± Ù‚Ø§Ø¦Ø¯Ø§Ù‹');
            
            const t = teams.find(tm => tm.id === pendingTeamId);
            t.members.push(user);
            t.leader = selectedLeader;
            team = t;
            
            document.getElementById('leaderModal').classList.remove('show');
            document.getElementById('startBtn').classList.add('show');
            renderTeams();
        }
        
        function updateTeamName(teamId) {
            const t = teams.find(tm => tm.id === teamId);
            const newName = document.getElementById(`teamName${teamId}`).value.trim();
            if (newName) {
                t.teamName = newName;
                renderTeams();
            }
        }
        
        function editTeam(teamId) {
            alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚! âœ…');
            renderTeams();
        }
        
        function confirmLeaveTeam(teamId) {
            pendingTeamId = teamId;
            pendingAction = 'leave';
            const t = teams.find(tm => tm.id === teamId);
            
            document.getElementById('modalTitle').textContent = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©';
            document.getElementById('modalMessage').textContent = 
                `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…ØºØ§Ø¯Ø±Ø© ÙØ±ÙŠÙ‚ "${t.teamName || t.name}"ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙƒ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚.`;
            document.getElementById('confirmModal').classList.add('show');
        }
        
        function confirmAction() {
            if (pendingAction === 'leave') {
                leaveTeam(pendingTeamId);
            }
            document.getElementById('confirmModal').classList.remove('show');
            pendingAction = null;
            pendingTeamId = null;
        }
        
        function cancelAction() {
            document.getElementById('confirmModal').classList.remove('show');
            document.getElementById('leaderModal').classList.remove('show');
            pendingAction = null;
            pendingTeamId = null;
        }
        
        function leaveTeam(teamId) {
            const t = teams.find(tm => tm.id === teamId);
            t.members = t.members.filter(m => m !== user);
            if (t.leader === user) {
                t.leader = t.members.length > 0 ? t.members[0] : null;
            }
            if (team && team.id === teamId) {
                team = null;
                document.getElementById('startBtn').classList.remove('show');
            }
            alert('ØªÙ… Ø­Ø°ÙÙƒ Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ âœ…');
            renderTeams();
        }
        
        function startChallenge() {
            if (!team || team.members.length === 0) return alert('Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ø§Ù‹');
            
            caseIdx = 0;
            timeLeft = 7200;
            stats = {attempts: 0, solved: 0};
            allStats[team.id] = {
                name: team.teamName || team.name, 
                leader: team.leader,
                attempts: 0, 
                solved: 0, 
                failed: false
            };
            
            showScreen('challengeScreen');
            document.getElementById('currentTeamName').textContent = `ğŸ‘¥ ${team.teamName || team.name}`;
            document.getElementById('leaderInfo').textContent = `â­ Ø§Ù„Ù‚Ø§Ø¦Ø¯: ${team.leader}`;
            startTimer();
            showCase();
        }
        
        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft === 300) alert('âš ï¸ ØªØ­Ø°ÙŠØ±: 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø· Ù…ØªØ¨Ù‚ÙŠØ©!');
                if (timeLeft <= 0) endGame(false);
            }, 1000);
        }
        
        function updateTimer() {
            let h = Math.floor(timeLeft / 3600);
            let m = Math.floor((timeLeft % 3600) / 60);
            let s = timeLeft % 60;
            let timerEl = document.getElementById('timerDisplay');
            timerEl.textContent = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            if (timeLeft <= 300) timerEl.classList.add('danger');
        }
        
        // Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„ØµÙˆØ± - Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØµÙˆØ± Ù„Ø¯ÙŠÙƒ
        const imageUrls = {
            1: ['https://via.placeholder.com/400x300?text=Case1+Image1', 
                'https://via.placeholder.com/400x300?text=Case1+Image2',
                'https://via.placeholder.com/400x300?text=Case1+Image3',
                'https://via.placeholder.com/400x300?text=Case1+Image4',
                'https://via.placeholder.com/400x300?text=Case1+Image5',
                'https://via.placeholder.com/400x300?text=Case1+Image6',
                'https://via.placeholder.com/400x300?text=Case1+Image7',
                'https://via.placeholder.com/400x300?text=Case1+Image8'],
            2: ['https://via.placeholder.com/400x300?text=Case2+Image1',
                'https://via.placeholder.com/400x300?text=Case2+Image2',
                'https://via.placeholder.com/400x300?text=Case2+Image3',
                'https://via.placeholder.com/400x300?text=Case2+Image4',
                'https://via.placeholder.com/400x300?text=Case2+Image5',
                'https://via.placeholder.com/400x300?text=Case2+Image6',
                'https://via.placeholder.com/400x300?text=Case2+Image7',
                'https://via.placeholder.com/400x300?text=Case2+Image8'],
            3: Array(8).fill('https://via.placeholder.com/400x300?text=Case3'),
            4: Array(8).fill('https://via.placeholder.com/400x300?text=Case4'),
            5: Array(8).fill('https://via.placeholder.com/400x300?text=Case5'),
            6: Array(8).fill('https://via.placeholder.com/400x300?text=Case6'),
            7: Array(8).fill('https://via.placeholder.com/400x300?text=Case7'),
            8: Array(8).fill('https://via.placeholder.com/400x300?text=Case8'),
            9: Array(8).fill('https://via.placeholder.com/400x300?text=Case9'),
            10: Array(8).fill('https://via.placeholder.com/400x300?text=Case10')
        };
        
        // Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù€ PDFs - Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø¯ÙŠÙƒ
        const pdfUrls = {
            1: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            2: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            3: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            4: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            5: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            6: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            7: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            8: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            9: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf',
            10: 'https://www.w3.org/WAI/WCAG21/Techniques/pdf/img/table.pdf'
        };
        
        function showCase() {
            const c = cases[caseIdx];
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ± Ù…Ù† imageUrls
            const caseImages = imageUrls[c.id] || Array(8).fill('https://via.placeholder.com/400x300?text=ØµÙˆØ±Ø©');
            
            let imgs = caseImages.map((url, i) => 
                `<div class="image-box">
                    <img src="${url}" 
                         alt="ØµÙˆØ±Ø© ${i+1}"
                         style="width: 100%; height: 100%; object-fit: cover;">
                </div>`
            ).join('');
            
            const pdfUrl = pdfUrls[c.id] || '#';
            
            document.getElementById('caseBox').innerHTML = `
                <h2 class="case-title">ğŸ” Ø§Ù„Ù‚Ø¶ÙŠØ© ${caseIdx + 1}: ${c.title}</h2>
                <div class="images-grid">${imgs}</div>
                <button class="pdf-btn" onclick="downloadPDF('${pdfUrl}', '${c.title}')">
                    ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF - ${c.title}
                </button>
                <input type="text" class="code-input" id="codeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´ÙØ±Ø© Ø§Ù„Ø³Ø±ÙŠØ©" onkeypress="if(event.key==='Enter') verify()">
                <button class="code-btn" onclick="verify()">âœ“ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙØ±Ø©</button>
                <div class="message" id="msg"></div>
                <div class="progress">ğŸ“‹ Ø§Ù„Ù‚Ø¶ÙŠØ© ${caseIdx + 1} Ù…Ù† 10</div>
            `;
            document.getElementById('codeInput').focus();
        }
        
        function verify() {
            let code = document.getElementById('codeInput').value.toUpperCase().trim();
            let correct = cases[caseIdx].code;
            let msg = document.getElementById('msg');
            
            if (code === correct) {
                msg.textContent = 'âœ… ØµØ­ÙŠØ­! Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø©!';
                msg.className = 'message success';
                burst();
                stats.solved++;
                allStats[team.id].solved = stats.solved;
                setTimeout(() => {
                    caseIdx < 9 ? showCase() : endGame(true);
                }, 1500);
            } else {
                msg.textContent = 'âŒ Ø®Ø·Ø£! -15 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±Ù‚!';
                msg.className = 'message error';
                stats.attempts++;
                allStats[team.id].attempts = stats.attempts;
                timeLeft = Math.max(0, timeLeft - 900);
                document.getElementById('codeInput').value = '';
            }
        }
        
        function burst() {
            for (let i = 0; i < 40; i++) {
                let star = document.createElement('div');
                star.className = 'star';
                star.textContent = ['â­', 'âœ¨', 'ğŸŒŸ'][Math.floor(Math.random() * 3)];
                let angle = (i / 40) * Math.PI * 2;
                let dist = 150;
                star.style.setProperty('--tx', Math.cos(angle) * dist + 'px');
                star.style.setProperty('--ty', Math.sin(angle) * dist + 'px');
                star.style.left = window.innerWidth / 2 + 'px';
                star.style.top = window.innerHeight / 2 + 'px';
                document.body.appendChild(star);
                setTimeout(() => star.remove(), 1500);
            }
        }
        
        function downloadPDF(url, filename) {
            let a = document.createElement('a');
            a.href = url;
            a.download = filename + '.pdf';
            a.click();
        }
        
        function endGame(win) {
            clearInterval(timer);
            if (win) {
                allStats[team.id].failed = false;
                showLeaderboard();
            } else {
                allStats[team.id].failed = true;
                document.getElementById('failDetails').innerHTML = `
                    <h3>${team.teamName || team.name}</h3>
                    <p>â­ Ø§Ù„Ù‚Ø§Ø¦Ø¯: ${team.leader}</p>
                    <p>Ø­Ù„ ${stats.solved}/10 Ù‚Ø¶Ø§ÙŠØ§</p>
                    <p>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©: ${stats.attempts}</p>
                `;
                showScreen('failScreen');
            }
        }
        
        function showLeaderboard() {
            let sorted = Object.entries(allStats).map(([id, s]) => s)
                .sort((a, b) => {
                    if (a.failed !== b.failed) return a.failed ? 1 : -1;
                    if (b.solved !== a.solved) return b.solved - a.solved;
                    return a.attempts - b.attempts;
                });
            
            let html = '';
            sorted.forEach((s, i) => {
                let medal = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][i] || (i + 1);
                html += `<tr>
                    <td>${medal}</td>
                    <td><strong>${s.name}</strong></td>
                    <td>${s.leader}</td>
                    <td>${s.attempts}</td>
                    <td>${s.solved}/10</td>
                    <td>${s.failed ? 'âŒ ÙØ´Ù„' : 'âœ… Ù†Ø¬Ø­'}</td>
                </tr>`;
            });
            
            document.getElementById('leaderboardBody').innerHTML = html;
            showScreen('leaderboardScreen');
        }
        
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>