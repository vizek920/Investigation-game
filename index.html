<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ­Ù‚ÙŠÙ‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 100%);
            color: #ffffff;
        }

        body.light-mode {
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            color: #000000;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 107, 53, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(135deg, #ff6b35, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }

        .login-box {
            background: rgba(255, 107, 53, 0.1);
            padding: 40px;
            border-radius: 15px;
            border: 2px solid #ff6b35;
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-box h2 {
            margin-bottom: 30px;
            font-size: 2em;
            color: #ff6b35;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff6b35;
            border-radius: 5px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }

        .teams-screen {
            display: none;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .team-card {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }

        .team-card.selected {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .team-card h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .team-members {
            font-size: 0.9em;
            margin: 10px 0;
        }

        .team-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 2px;
        }

        .start-challenge-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ffd700, #ff6b35);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
        }

        .challenge-screen {
            display: none;
        }

        .timer-section {
            text-align: center;
            font-size: 2.5em;
            font-weight: bold;
            color: #ff6b35;
            padding: 20px;
            border-radius: 10px;
            background: rgba(255, 107, 53, 0.1);
            margin-bottom: 30px;
        }

        .timer-section.warning {
            animation: pulse 1s infinite;
            color: #ff0000;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .case-container {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .case-title {
            font-size: 1.8em;
            color: #ff6b35;
            margin-bottom: 20px;
            text-align: center;
        }

        .case-images {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .case-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .case-image img:hover {
            transform: scale(1.05);
        }

        @keyframes starBurst {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        .star {
            position: fixed;
            pointer-events: none;
            font-size: 2em;
            animation: starBurst 1.5s ease-out forwards;
            z-index: 9999;
        }

        .pdf-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .code-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff6b35;
            border-radius: 5px;
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.1);
            color: inherit;
            text-align: center;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .code-submit-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }

        .code-message {
            text-align: center;
            margin-top: 10px;
            font-size: 1.1em;
            font-weight: bold;
            min-height: 25px;
        }

        .code-message.success {
            color: #4CAF50;
        }

        .code-message.error {
            color: #ff0000;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .case-progress {
            text-align: center;
            font-size: 1.1em;
            margin-top: 20px;
            color: #ff6b35;
        }

        .leaderboard-screen {
            display: none;
        }

        .leaderboard-container {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid #ff6b35;
            padding: 30px;
            border-radius: 15px;
        }

        .leaderboard-title {
            font-size: 2.5em;
            text-align: center;
            color: #ff6b35;
            margin-bottom: 30px;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ff6b35;
        }

        .leaderboard-table th {
            background: rgba(255, 107, 53, 0.2);
            color: #ff6b35;
        }

        .fail-screen {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .fail-message {
            font-size: 3em;
            color: #ff0000;
            margin-bottom: 30px;
        }

        .restart-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ffd700, #ff6b35);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container">
        <div class="header">
            <h1>ğŸ” Ù„Ø¹Ø¨Ø© Ø§Ù„ØªØ­Ù‚ÙŠÙ‚</h1>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„</button>
        </div>

        <div class="login-screen" id="loginScreen">
            <div class="login-box">
                <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h2>
                <div class="form-group">
                    <input type="text" id="usernameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
                </div>
                <button class="login-btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>

        <div class="teams-screen" id="teamsScreen">
            <h2 style="text-align: center; margin-bottom: 30px;">Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ùƒ</h2>
            <div class="teams-grid" id="teamsGrid"></div>
            <button class="start-challenge-btn" onclick="startChallenge()" id="startBtn" style="display: none;">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ</button>
        </div>

        <div class="challenge-screen" id="challengeScreen">
            <div class="timer-section" id="timerDisplay">02:00:00</div>
            <div class="case-container" id="caseContainer"></div>
        </div>

        <div class="leaderboard-screen" id="leaderboardScreen">
            <div class="leaderboard-container">
                <h2 class="leaderboard-title">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø±ØªØ¨Ø©</th>
                            <th>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</th>
                            <th>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</th>
                            <th>Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody"></tbody>
                </table>
                <button class="restart-btn" onclick="restartGame()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
        </div>

        <div class="fail-screen" id="failScreen">
            <div class="fail-message">âŒ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</div>
            <div class="fail-details" id="failDetails"></div>
            <button class="restart-btn" onclick="restartGame()">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
    </div>

    <script>
        const gameData = {
            teams: Array.from({length: 10}, (_, i) => ({
                id: i + 1,
                name: `Ø§Ù„ÙØ±ÙŠÙ‚ ${i + 1}`,
                members: [],
                leader: null,
                teamName: null
            })),
            cases: [
                {id: 1, title: 'Ù…Ù† ÙŠÙƒÙˆÙ†ØŸ', code: 'SCREAM001', pdf: 'cases/case1/case1.pdf', images: 8},
                {id: 2, title: 'Ù…Ù„Ù Ø§Ù„Ø°ÙƒØ§Ø¡', code: 'GHOSTFACE', pdf: 'cases/case2/case2.pdf', images: 8},
                {id: 3, title: 'Ù…Ù„Ù Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ', code: 'PROFILE99', pdf: 'cases/case3/case3.pdf', images: 8},
                {id: 4, title: 'Ø§Ù„Ø£Ø¯Ù„Ø©', code: 'EVIDENCE1', pdf: 'cases/case4/case4.pdf', images: 8},
                {id: 5, title: 'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡', code: 'CHEMICAL2', pdf: 'cases/case5/case5.pdf', images: 8},
                {id: 6, title: 'Ø£Ø¯Ù„Ø© Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©', code: 'EVIDENCE3', pdf: 'cases/case6/case6.pdf', images: 8},
                {id: 7, title: 'Ø®Ø· Ø§Ù„Ø¯Ù…', code: 'BLOODLINE', pdf: 'cases/case7/case7.pdf', images: 8},
                {id: 8, title: 'Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ', code: 'FORENSICS', pdf: 'cases/case8/case8.pdf', images: 8},
                {id: 9, title: 'Ø§Ù„Ø¶Ø­ÙŠØ©', code: 'VICTIM666', pdf: 'cases/case9/case9.pdf', images: 8},
                {id: 10, title: 'Ø§Ù„Ù…Ø´ØªØ¨Ù‡ Ø¨Ù‡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', code: 'SUSPECT42', pdf: 'cases/case10/case10.pdf', images: 8}
            ]
        };

        let currentUser = null;
        let currentTeam = null;
        let currentCaseIndex = 0;
        let gameTimer = null;
        let timeRemaining = 7200;
        let gameStarted = false;
        let teamStats = {};
        let allTeamsStats = {};
        let wrongAttempts = 0;

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
        }

        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ');
                return;
            }
            currentUser = username;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('teamsScreen').classList.remove('hidden');
            renderTeams();
        }

        function renderTeams() {
            const grid = document.getElementById('teamsGrid');
            grid.innerHTML = '';
            gameData.teams.forEach(team => {
                const card = document.createElement('div');
                card.className = 'team-card';
                if (currentTeam && currentTeam.id === team.id) {
                    card.classList.add('selected');
                }
                card.innerHTML = `
                    <h3>${team.teamName || team.name}</h3>
                    <div class="team-members">
                        <p>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${team.members.length}/4</p>
                        ${team.members.length > 0 ? `<p>${team.members.join(', ')}</p>` : ''}
                    </div>
                    <button class="team-btn" onclick="joinTeam(${team.id})">Ø§Ù†Ø¶Ù…</button>
                    ${team.members.includes(currentUser) ? `<button class="team-btn" onclick="leaveTeam(${team.id})">ØºØ§Ø¯Ø±</button>` : ''}
                `;
                grid.appendChild(card);
            });
        }

        function joinTeam(teamId) {
            const team = gameData.teams.find(t => t.id === teamId);
            if (team.members.includes(currentUser)) {
                alert('Ø£Ù†Øª Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ‚');
                return;
            }
            if (team.members.length >= 4) {
                alert('Ø§Ù„ÙØ±ÙŠÙ‚ Ù…Ù…ØªÙ„Ø¦');
                return;
            }
            team.members.push(currentUser);
            if (!team.leader) team.leader = currentUser;
            currentTeam = team;
            document.getElementById('startBtn').style.display = team.members.length > 0 ? 'block' : 'none';
            renderTeams();
        }

        function leaveTeam(teamId) {
            const team = gameData.teams.find(t => t.id === teamId);
            team.members = team.members.filter(m => m !== currentUser);
            if (team.leader === currentUser && team.members.length > 0) {
                team.leader = team.members[0];
            } else if (team.members.length === 0) {
                team.leader = null;
            }
            currentTeam = null;
            document.getElementById('startBtn').style.display = 'none';
            renderTeams();
        }

        function startChallenge() {
            if (!currentTeam || currentTeam.members.length === 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ÙØ±ÙŠÙ‚');
                return;
            }
            gameStarted = true;
            timeRemaining = 7200;
            teamStats = {attempts: 0, solvedCases: 0};
            allTeamsStats[currentTeam.id] = {
                teamName: currentTeam.teamName || currentTeam.name,
                attempts: 0,
                solvedCases: 0,
                failed: false
            };
            document.getElementById('teamsScreen').classList.add('hidden');
            document.getElementById('challengeScreen').classList.remove('hidden');
            startTimer();
            renderCase();
        }

        function startTimer() {
            gameTimer = setInterval(() => {
                timeRemaining--;
                if (timeRemaining === 300) {
                    alert('âš ï¸ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…ØªØ¨Ù‚ÙŠØ©!');
                }
                if (timeRemaining <= 0) {
                    clearInterval(gameTimer);
                    endGame();
                }
                updateTimer();
            }, 1000);
        }

        function updateTimer() {
            const h = Math.floor(timeRemaining / 3600);
            const m = Math.floor((timeRemaining % 3600) / 60);
            const s = timeRemaining % 60;
            const display = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            const timer = document.getElementById('timerDisplay');
            timer.textContent = display;
            if (timeRemaining <= 300) {
                timer.classList.add('warning');
            }
        }

        function renderCase() {
            const c = gameData.cases[currentCaseIndex];
            const imagesHTML = Array.from({length: 8}).map((_, i) => 
                `<div class="case-image">
                    <img src="cases/case${c.id}/image${i + 1}.jpg" alt="ØµÙˆØ±Ø© ${i + 1}" onerror="this.textContent='ØµÙˆØ±Ø© ${i + 1}'">
                </div>`
            ).join('');
            
            const html = `
                <h2 class="case-title">ğŸ” ${c.title}</h2>
                <div class="case-images">
                    ${imagesHTML}
                </div>
                <button class="pdf-btn" onclick="downloadPDF('${c.pdf}', '${c.title}')">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ PDF - ${c.title}</button>
                <input type="text" id="codeInput" class="code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø´ÙØ±Ø© Ø§Ù„Ø³Ø±ÙŠØ©">
                <button class="code-submit-btn" onclick="checkCode()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´ÙØ±Ø©</button>
                <div class="code-message" id="codeMessage"></div>
                <div class="case-progress">Ø§Ù„Ù‚Ø¶ÙŠØ© ${currentCaseIndex + 1} Ù…Ù† 10</div>
            `;
            document.getElementById('caseContainer').innerHTML = html;
            document.getElementById('codeInput').focus();
        }

        function checkCode() {
            const input = document.getElementById('codeInput').value.trim().toUpperCase();
            const correct = gameData.cases[currentCaseIndex].code;
            const msg = document.getElementById('codeMessage');
            
            if (input === correct) {
                msg.textContent = 'âœ… ØµØ­ÙŠØ­! Ø¥Ø¬Ø§Ø¨Ø© Ø±Ø§Ø¦Ø¹Ø©!';
                msg.className = 'code-message success';
                createStarBurst();
                createGlow();
                teamStats.solvedCases++;
                allTeamsStats[currentTeam.id].solvedCases = teamStats.solvedCases;
                setTimeout(() => {
                    if (currentCaseIndex < 9) {
                        currentCaseIndex++;
                        renderCase();
                    } else {
                        endGame(true);
                    }
                }, 1500);
            } else {
                msg.textContent = 'âŒ Ø®Ø·Ø£! -15 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±Ù‚!';
                msg.className = 'code-message error';
                teamStats.attempts++;
                timeRemaining -= 900;
                document.getElementById('codeInput').value = '';
                document.getElementById('codeInput').focus();
            }
        }

        function createStarBurst() {
            const burstCount = 30;
            for (let i = 0; i < burstCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = ['â­', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'][Math.floor(Math.random() * 4)];
                
                const angle = (i / burstCount) * Math.PI * 2;
                const distance = 150;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                star.style.setProperty('--tx', tx + 'px');
                star.style.setProperty('--ty', ty + 'px');
                star.style.left = window.innerWidth / 2 + 'px';
                star.style.top = window.innerHeight / 2 + 'px';
                
                document.body.appendChild(star);
                setTimeout(() => star.remove(), 1500);
            }
        }

        function createGlow() {
            const container = document.getElementById('caseContainer');
            container.style.boxShadow = '0 0 50px rgba(255, 107, 53, 0.8), 0 0 100px rgba(255, 215, 0, 0.6)';
            setTimeout(() => {
                container.style.boxShadow = '0 0 0 rgba(255, 107, 53, 0)';
            }, 500);
        }

        function downloadPDF(pdf, title) {
            const link = document.createElement('a');
            link.href = pdf;
            link.download = `${title}.pdf`;
            link.click();
        }

        function endGame(completed = false) {
            clearInterval(gameTimer);
            gameStarted = false;
            document.getElementById('challengeScreen').classList.add('hidden');
            
            if (completed && currentCaseIndex === 9) {
                showLeaderboard();
            } else {
                document.getElementById('failScreen').classList.remove('hidden');
                document.getElementById('failDetails').textContent = `ÙØ±ÙŠÙ‚ ${currentTeam.teamName || currentTeam.name}\nØ­Ù„ ${teamStats.solvedCases} Ù…Ù† 10 Ù‚Ø¶Ø§ÙŠØ§`;
            }
        }

        function showLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';
            let rank = 1;
            Object.values(allTeamsStats).sort((a, b) => b.solvedCases - a.solvedCases).forEach(team => {
                const row = `<tr>
                    <td>${rank++}</td>
                    <td>${team.teamName}</td>
                    <td>${team.attempts}</td>
                    <td>${team.solvedCases}/10</td>
                    <td>${team.solvedCases === 10 ? 'âœ… Ù†Ø¬Ø­' : 'âŒ ÙØ´Ù„'}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
            document.getElementById('leaderboardScreen').classList.remove('hidden');
        }

        function restartGame() {
            location.reload();
        }

        // Initialize
        document.getElementById('teamsScreen').classList.add('hidden');
        document.getElementById('challengeScreen').classList.add('hidden');
        document.getElementById('leaderboardScreen').classList.add('hidden');
        document.getElementById('failScreen').classList.add('hidden');
    </script>
</body>
</html>
